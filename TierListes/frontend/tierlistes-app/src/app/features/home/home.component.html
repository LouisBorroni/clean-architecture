@if (!paymentService.isChecked() || tierlistService.isLoading()) {
  <div class="page-loader">
    <div class="spinner"></div>
    <p>Chargement...</p>
  </div>
} @else {
  <div class="home-container">
    <header class="header">
      <h1>TierListes</h1>
      <div class="user-info">
        @if (authService.currentUser(); as user) {
          <span class="username">{{ user.username }}</span>
          <button class="btn-logout" (click)="logout()">Déconnexion</button>
        }
      </div>
    </header>

    <main class="main-content">
      @if (!paymentService.hasPaid()) {
        <div class="payment-banner">
          <div class="payment-content">
            <span class="payment-icon">&#128274;</span>
            <div class="payment-text">
              <strong>Débloquez la Tier List</strong>
              <p>Payez une fois pour créer et organiser votre tier list</p>
            </div>
            <button class="btn-pay" (click)="pay()" [disabled]="paymentService.isLoading()">
              {{ paymentService.isLoading() ? 'Redirection...' : 'Payer maintenant' }}
            </button>
          </div>
        </div>
      }

      <div class="tierlist-container" [class.locked]="!paymentService.hasPaid()">
        <div class="tierlist-header">
          <h2>Ma Tier List</h2>
          <div class="header-actions">
            <button class="btn-export" (click)="exportPdf()" [disabled]="isExporting || !paymentService.hasPaid()">
              {{ isExporting ? 'Export en cours...' : 'Exporter en PDF' }}
            </button>
            <button class="btn-reset" (click)="reset()" [disabled]="!paymentService.hasPaid()">Réinitialiser</button>
          </div>
        </div>

        <div class="tiers" #tierlistCapture>
          @for (tier of tierlistService.tiers(); track tier.level) {
            <div class="tier-row">
              <div class="tier-label" [style.background]="tier.color">
                {{ tier.label }}
              </div>
              <div
                class="tier-content"
                cdkDropList
                cdkDropListOrientation="horizontal"
                [id]="'tier-' + tier.level"
                [cdkDropListData]="tier.companies"
                [cdkDropListConnectedTo]="getConnectedLists()"
                [cdkDropListDisabled]="!paymentService.hasPaid()"
                (cdkDropListDropped)="drop($event)"
              >
                @for (company of tier.companies; track company.id) {
                  <div class="company-card" cdkDrag [cdkDragDisabled]="!paymentService.hasPaid()">
                    <img [src]="company.logoUrl" [alt]="company.name" class="company-logo">
                    <span class="company-name">{{ company.name }}</span>
                  </div>
                }
              </div>
            </div>
          }
        </div>

        <div class="unranked-section">
          <h3>Entreprises à classer</h3>
          <div
            class="unranked-list"
            cdkDropList
            cdkDropListOrientation="horizontal"
            id="unranked"
            [cdkDropListData]="tierlistService.unrankedCompanies()"
            [cdkDropListConnectedTo]="getConnectedLists()"
            [cdkDropListDisabled]="!paymentService.hasPaid()"
            (cdkDropListDropped)="drop($event)"
          >
            @for (company of tierlistService.unrankedCompanies(); track company.id) {
              <div class="company-card" [class.disabled]="!paymentService.hasPaid()" cdkDrag [cdkDragDisabled]="!paymentService.hasPaid()">
                <img [src]="company.logoUrl" [alt]="company.name" class="company-logo">
                <span class="company-name">{{ company.name }}</span>
              </div>
            }
          </div>
        </div>
      </div>
    </main>
  </div>
}
