<div class="home-container">
  <header class="header">
    <h1>TierListes</h1>
    <div class="user-info">
      @if (authService.currentUser(); as user) {
        <span class="username">{{ user.username }}</span>
        <button class="btn-logout" (click)="logout()">Déconnexion</button>
      }
    </div>
  </header>

  <main class="main-content">
    @if (tierlistService.isLoading()) {
      <div class="loading">Chargement...</div>
    } @else {
      <div class="tierlist-container">
        <div class="tierlist-header">
          <h2>Ma Tier List</h2>
          <div class="header-actions">
            <button class="btn-export" (click)="exportPdf()" [disabled]="isExporting">
              {{ isExporting ? 'Export en cours...' : 'Exporter en PDF' }}
            </button>
            <button class="btn-reset" (click)="reset()">Réinitialiser</button>
          </div>
        </div>

        <div class="tiers" #tierlistCapture>
          @for (tier of tierlistService.tiers(); track tier.level) {
            <div class="tier-row">
              <div class="tier-label" [style.background]="tier.color">
                {{ tier.label }}
              </div>
              <div
                class="tier-content"
                cdkDropList
                [id]="'tier-' + tier.level"
                [cdkDropListData]="tier.companies"
                [cdkDropListConnectedTo]="getConnectedLists()"
                (cdkDropListDropped)="drop($event)"
              >
                @for (company of tier.companies; track company.id) {
                  <div class="company-card" cdkDrag>
                    <img [src]="company.logoUrl" [alt]="company.name" class="company-logo">
                    <span class="company-name">{{ company.name }}</span>
                  </div>
                }
              </div>
            </div>
          }
        </div>

        <div class="unranked-section">
          <h3>Entreprises à classer</h3>
          <div
            class="unranked-list"
            cdkDropList
            id="unranked"
            [cdkDropListData]="tierlistService.unrankedCompanies()"
            [cdkDropListConnectedTo]="getConnectedLists()"
            (cdkDropListDropped)="drop($event)"
          >
            @for (company of tierlistService.unrankedCompanies(); track company.id) {
              <div class="company-card" cdkDrag>
                <img [src]="company.logoUrl" [alt]="company.name" class="company-logo">
                <span class="company-name">{{ company.name }}</span>
              </div>
            }
          </div>
        </div>
      </div>
    }
  </main>
</div>
